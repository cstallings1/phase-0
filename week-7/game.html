<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link type="text/css" rel="stylesheet" href="game.css">

  <title>
    Space Adventures
  </title>
</head>

<body>
  <header>
    Welcome to Space Adventures!
  </header>
  <canvas id="canvas">
  </canvas>
  <script>
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    var astronaut = {
      color: "#0040FF",
      width: 25,
      height: 25,
      x: 0,
      y: 0,
      speed: 250,
      draw: function() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      },
    };

    var martian = {
      x: 0,
      y: 0,
      health: 100,
      color: "#00FF40",
      width: 25,
      height: 25,
      draw: function() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    };

    var spaceship = {
      x: Math.floor(Math.random() * (canvas.width - 1 + 1)) + 1,
      y: Math.floor(Math.random() * (canvas.height - 1 + 1)) + 1,
      color: "#FFFFFF",
      width: 25,
      height: 25,
      draw: function() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    };

    var raygun = {
      x: 0,
      y: 0,
      color: "#808080",
      width: 8,
      height: 8,
      draw: function() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    };

    var keyStrokes = {};

    addEventListener("keydown", function(e){
      debugger
      keyStrokes[e.keyCode] = true;
    }, false);

    addEventListener("keyup", function(e) {
      delete keyStrokes[e.keyCode];
    }, false);

    var newGame = function() {
      astronaut.x = Math.floor(Math.random() * (canvas.width - 1 + 1)) + 1;
      astronaut.y = Math.floor(Math.random() * (canvas.height - 1 + 1)) + 1;
      martian.x = Math.floor(Math.random() * (canvas.width - 1 + 1)) + 1;
      martian.y = Math.floor(Math.random() * (canvas.height - 1 + 1)) + 1;
      spaceship.x = Math.floor(Math.random() * (canvas.width - 1 + 1)) + 1;
      spaceship.y = Math.floor(Math.random() * (canvas.height - 1 + 1)) + 1;
    };

    //Moves astronaut and martian
    var movement = function(modifier) {
      if (keyStrokes.hasOwnProperty(39)) {
        astronaut.x += speed * modifier; //Moves Right
      } else if (keyStrokes.hasOwnProperty(37)) {
        astronaut.x -= speed * modifier; //Moves left
      } else if (keyStrokes.hasOwnProperty(38)) {
        astronaut.y += speed * modifier; //Moves up
      } else if (keyStrokes.hasOwnProperty(40)) {
        astronaut.y -= speed * modifier; //Moves down
      } else if (keyStrokes.hasOwnProperty(13)) {
        raygun.x = Math.floor(Math.random() * (martian.x - 1 + 1)) + 1;
        raygun.y = Math.floor(Math.random() * (martian.y - 1 + 1)) + 1;
      }

      martian.x = Math.floor(Math.random() * (canvas.width - 1 + 1)) + 1;
      martian.y = Math.floor(Math.random() * (canvas.height - 1 + 1)) + 1;

      //Check if astronaut made it to the ship
      if (astronaut.x === spaceship.x && astronaut.y === spaceship.y) {
        alert("You made it back to the ship safe and sound.");
        newGame();
      }

      //Check if raygun hit martian
      if (raygun.x === martian.x && raygun.y === martian.y) {
        martian.health -= 50;
      }
      if (martian.health == 0) {
        console.log("Congratulations you killed the martian! Now you can safely go back to the spaceship.");
        newGame();
      }

     //Check if martian captured astronaut
      if (astronaut.x === martian.x && astronaut.y === martian.y) {
        alert("The martian captured you GAME OVER");
        newGame();
       }
    };

    var render = function() {
      astronaut.draw();
      martian.draw();
      spaceship.draw();
    };

    var gameLoop = function() {
      var now = Date.now();
      var diff = now - then;
      movement(diff / 1000);
      render();

      then = now;

      requestAnimationFrame(movement);
    };

    //Start the game
    var then = Date.now();
    newGame();
    gameLoop();

  </script>
</body>
</html>